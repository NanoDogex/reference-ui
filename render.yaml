services:

  # =========================
  # üåê FRONTEND (STATIC VITE)
  # =========================
  - type: web
    name: ghostgpt-frontend
    runtime: static
    repo: https://github.com/NanoDogex/reference-ui
    branch: main
    buildCommand: npm install && npm run build
    staticPublishPath: src/dist
    autoDeployTrigger: commit
    envVars:
      - key: VITE_WEAVIATE_URL
        sync: false
      - key: VITE_WEAVIATE_API_KEY
        sync: false
      - key: VITE_SUPABASE_URL
        sync: false
      - key: VITE_SUPABASE_API_KEY
        sync: false
      - key: VITE_API_URL
        sync: false

  # =========================
  # üëª TELEGRAM POLLING BOT
  # =========================
  - type: worker
    name: ghostgpt-bot
    runtime: python
    repo: https://github.com/NanoDogex/reference-ui
    branch: main
    plan: free
    buildCommand: pip install -r requirements.txt
    startCommand: python bot.py
    autoDeployTrigger: commit
    envVars:
      - key: BOT_TOKEN
        sync: false
      - key: ADMIN_ID
        sync: false
      - key: CHANNEL_USERNAME
        sync: false

  # =========================
  # üî• API SERVICE (GUNICORN)
  # =========================
  - type: web
    name: ghostgpt-api
    runtime: python
    repo: https://github.com/NanoDogex/reference-ui
    branch: main
    plan: free
    buildCommand: pip install -r api/requirements.txt
    startCommand: gunicorn --chdir api service:app
    autoDeployTrigger: commit
    envVars:
      - key: BOT_TOKEN
        sync: false
      - key: GOOGLE_API_KEY
        sync: false
      - key: REDIS_URL
        fromService:
          type: keyvalue
          name: ghostgpt-redis
          property: connectionString

  # =========================
  # ‚ö° REDIS
  # =========================
  - type: keyvalue
    name: ghostgpt-redis
    plan: free
    maxmemoryPolicy: allkeys-lru
    ipAllowList: []
